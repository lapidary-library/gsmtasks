# Account
- op: add
  path: /components/schemas/Account/properties/stripe_payment_method_id/nullable
  value: true
- op: add
  path: /components/schemas/Account/properties/stripe_customer_id/nullable
  value: true
- op: replace
  path: /components/schemas/Account/properties/task_duration
  value:
    $ref: '#/components/schemas/TaskDuration_'
- op: replace
  path: /components/schemas/Account/properties/feature_geocoding_country_code
  value:
    oneOf:
    - $ref: '#/components/schemas/CountryCodeEnum'
    - $ref: '#/components/schemas/BlankEnum'
    readOnly: true
    description: Limit geocoding to the selected country.

- op: add
  path: /components/schemas/DateFormatEnum/x-lapidary-enum-names
  value:
    dmy_dot: DD.MM.YYYY
    dmy_slash: DD/MM/YYYY
    iso: YYYY-MM-DD

# Task
- op: add
  path: /components/schemas/TaskSerializerV2/properties/cancelled_at/nullable
  value: true
- op: add
  path: /components/schemas/TaskSerializerV2/properties/completed_at/nullable
  value: true
- op: add
  path: /components/schemas/TaskSerializerV2/properties/orderer_name/nullable
  value: true
- op: add
  path: /components/schemas/TaskSerializerV2/additionalProperties
  value: false
- op: replace
  path: /components/schemas/TaskSerializerV2/properties/duration
  value:
    $ref: '#/components/schemas/TaskDuration_'
- op: replace
  path: /components/schemas/TaskSerializerV2/properties/actions
  value:
    type: array
    items:
      type: string
    readOnly: true

# Address
- op: add
  path: /components/schemas/NestedAddress/properties/geocoded_at/nullable
  value: true
- op: add
  path: /components/schemas/NestedAddress/properties/geocode_failed_at/nullable
  value: true

# task_list
- op: add
  path: /paths/~1tasks~1/get/parameters/-
  value:
    name: sideload
    in: query
    schema:
      type: array
      items:
        type: string
        enum:
        - metadatas
        - documents
      uniqueItems: true
#- op: replace
#  path: /paths/~1tasks~1/get/parameters/249/schema
#  value:
#    type: array
#    items:
#      type: string
#      format: uuid
- op: replace
  path: /paths/~1tasks~1/get/responses/200/content/application~1json; version=2.4.11/schema
  value:
    oneOf:
    - $ref: '#/components/schemas/PaginatedTaskSerializerV2List'
    - type: object
      x-lapidary-type-name: TaskListExt
      properties:
        tasks:
          $ref: '#/components/schemas/PaginatedTaskSerializerV2List'
        documents:
          $ref: '#/components/schemas/PaginatedDocumentList'
        metadatas:
          $ref: '#/components/schemas/PaginatedTaskMetadataList'
      required:
      - tasks
      additionalProperties: false
    additionalProperties: false

- op: replace
  path: /paths/~1tasks~1/post/responses/201/content/application~1json; version=2.4.11/schema
  value:
    oneOf:
    - $ref: '#/components/schemas/PaginatedTaskSerializerV2List'
    - $ref: '#/components/schemas/TaskSerializerV2'
    additionalProperties: false
- op: replace
  path: /paths/~1tasks~1/post/requestBody/content/application~1json/schema
  value:
    oneOf:
    - $ref: '#/components/schemas/PaginatedTaskSerializerV2List'
    - $ref: '#/components/schemas/TaskSerializerV2'
    additionalProperties: false

- op: add
  path: /components/schemas/Document/properties/file_name/nullable
  value: true
- op: add
  path: /components/schemas/Document/properties/mimetype/nullable
  value: true
- op: add
  path: /components/schemas/Document/properties/thumbnail/nullable
  value: true
- op: replace
  path: /paths/~1file_uploads~1/post/responses/201/content/application~1json; version=2.4.11/schema
  value:
    oneOf:
    - $ref: '#/components/schemas/PaginatedS3FileUploadList'
    - $ref: '#/components/schemas/S3FileUpload'
    additionalProperties: false
- op: replace
  path: /paths/~1file_uploads~1/post/requestBody/content/application~1json/schema
  value:
    oneOf:
    - $ref: '#/components/schemas/PaginatedS3FileUploadList'
    - $ref: '#/components/schemas/S3FileUpload'
    additionalProperties: false

- op: replace
  path: /paths/~1documents~1/post/requestBody/content/application~1json/schema
  value:
    oneOf:
    - $ref: '#/components/schemas/PaginatedDocumentList'
    - $ref: '#/components/schemas/Document'
    additionalProperties: false
- op: replace
  path: /paths/~1documents~1/post/responses/201/content/application~1json; version=2.4.11/schema
  value:
    oneOf:
    - $ref: '#/components/schemas/PaginatedDocumentList'
    - $ref: '#/components/schemas/Document'
    additionalProperties: false

- op: add
  path: /components/securitySchemes/tokenAuth/x-lapidary-value-prefix
  value: 'Token '

- op: add
  path: /servers
  value:
  - url: https://api.gsmtasks.com/

- op: add
  path: /x-lapidary-headers-global
  value:
    Accept: application/json; version=2.4.11

- op: add
  path: /components/schemas/GSMTasksError
  value:
    type: object
    properties:
      detail:
        type: string
    required:
    - detail
    x-lapidary-model-type: exception
    additionalProperties: false

- op: add
  path: /components/schemas/ValidationError
  value:
    type: object
    additionalProperties:
      type: array
      items:
        type: string
    x-lapidary-model-type: exception

- op: add
  path: /components/responses
  value:
    generic-error:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/GSMTasksError'
      description: Generic error
    validation-error:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationError'
      description: Validation error
- op: add
  path: /x-lapidary-responses-global
  value:
    '400':
      $ref: '#/components/responses/validation-error'
    '4XX':
      $ref: '#/components/responses/generic-error'
    '5XX':
      $ref: '#/components/responses/generic-error'

- op: replace
  path: /components/schemas/Metafield/properties/namespace/pattern
  value: ^[a-z0-9_]+$
- op: replace
  path: /components/schemas/Metafield/properties/key/pattern
  value: ^[a-z0-9_]+$

- op: add
  path: /components/schemas/TaskDuration_
  value:
    title: Task duration
    oneOf:
    - type: integer
    - type: string
    additionalProperties: false
- op: add
  path: /components/schemas/NullableTaskDuration_
  value:
    oneOf:
    - $ref: '#/components/schemas/TaskDuration_'
    nullable: true
    additionalProperties: false

- op: replace
  path: /components/schemas/TaskMetadata/properties/assigned_duration
  value:
    $ref: '#/components/schemas/NullableTaskDuration_'
- op: replace
  path: /components/schemas/TaskMetadata/properties/unassigned_duration
  value:
    $ref: '#/components/schemas/NullableTaskDuration_'
- op: replace
  path: /components/schemas/TaskMetadata/properties/accepted_duration
  value:
    $ref: '#/components/schemas/NullableTaskDuration_'
- op: replace
  path: /components/schemas/TaskMetadata/properties/transit_duration
  value:
    $ref: '#/components/schemas/NullableTaskDuration_'
- op: replace
  path: /components/schemas/TaskMetadata/properties/active_duration
  value:
    $ref: '#/components/schemas/NullableTaskDuration_'
- op: replace
  path: /components/schemas/TaskMetadata/properties/completed_duration
  value:
    $ref: '#/components/schemas/NullableTaskDuration_'
- op: replace
  path: /components/schemas/TaskMetadata/properties/failed_duration
  value:
    $ref: '#/components/schemas/NullableTaskDuration_'
- op: replace
  path: /components/schemas/TaskMetadata/properties/cancelled_duration
  value:
    $ref: '#/components/schemas/NullableTaskDuration_'
